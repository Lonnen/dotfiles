{"mode":"editor","version":1,"windowDimensions":{"x":958,"y":22,"width":958,"height":1058,"maximized":false},"syntax":{"deserializer":"Syntax","grammarOverridesByPath":{}},"project":{"paths":["/Users/lonnen/repos/leeroybot"],"buffers":[{"text":"# Description:\n#   Find the build status of an open-source project on Travis\n#   Can also notify about builds, just enable the webhook notification on travis http://about.travis-ci.org/docs/user/build-configuration/ -> 'Webhook notification'\n#\n# Dependencies:\n#\n# Configuration:\n#   HUBOT_TRAVIS_DEBUG - whether or not to output every incoming payload\n#\n# Commands:\n#   hubot travis <user>/<repo> - Returns the build status of https://github.com/<user>/<repo>\n#\n# URLS:\n#   POST /hubot/travis?room=<room>[&type=<type]\n#     - for XMPP servers (such as HipChat) this is the XMPP room id which has the form id@server\n#\n# Author:\n#   sferik\n#   nesQuick\n#   sergeylukin\n#   lonnen\n\nurl = require('url')\nquerystring = require('querystring')\n\n# hack attack!\n# a hardcoded map of email to irc handle\nusernameMap =\n    \"mail@peterbe.com\": \"peterbe\"\n    \"chris.lonnen@gmail.com\": \"lonnen\"\n    \"rhelmer@rhelmer.org\": \"rhelmer\"\n\n\nmodule.exports = (robot) ->\n\n  robot.respond /travis (.*)/i, (msg) ->\n    project = escape(msg.match[1])\n    msg.http(\"https://api.travis-ci.org/repos/#{project}\")\n      .get() (err, res, body) ->\n        response = JSON.parse(body)\n        if response.last_build_status == 0\n          msg.send \"Build status for #{project}: Passing\"\n        else if response.last_build_status == 1\n          msg.send \"Build status for #{project}: Failing\"\n        else\n          msg.send \"Build status for #{project}: Unknown\"\n\n  robot.router.post \"/hubot/travis\", (req, res) ->\n    query = querystring.parse url.parse(req.url).query\n\n    user = {}\n    user.room = query.room if query.room\n    user.type = query.type if query.type\n\n    try\n      payload = JSON.parse req.body.payload\n\n      if process.env.HUBOT_TRAVIS_DEBUG\n        console.log \"travis hook received: #{payload.type}\"\n\n      unless payload.type is \"pull_request\"\n        console.log \"ignoring travis hook type: #{payload.type}\"\n        res.end JSON.stringify { send: true }\n        return\n\n      email = payload.author_email\n      author = if email in usernameMap then usernameMap[email] else email\n      robot.send user, \"[#{payload.repository.name}] #{author} PR build #{payload.status_message.toUpperCase()}: #{payload.compare_url}\"\n    catch error\n      console.log \"travis hook error: #{error}. Payload: #{req.body.payload}\"\n\n    res.end JSON.stringify { send: true }\n","markers":{"markers":{"1":{"id":1,"range":[[49,0],[49,0]],"tailed":false,"reversed":false,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":46,"goalScreenRange":null,"autoscroll":true,"preserveFolds":true},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[],"deserializer":"History","version":1},"encoding":"utf8","filePath":"/Users/lonnen/repos/leeroybot/scripts/travis.coffee","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"c7bbd6875add0de1a96635eacee8c750e62c0673","deserializer":"TextBuffer"},{"text":"{\n  \"name\": \"hosted-hubot\",\n  \"version\": \"2.7.1\",\n  \"private\": true,\n  \"author\": \"GitHub Inc.\",\n  \"keywords\": [\n    \"github\",\n    \"hubot\",\n    \"campfire\",\n    \"bot\"\n  ],\n  \"description\": \"A simple helpful robot for your Company\",\n  \"licenses\": [\n    {\n      \"type\": \"MIT\",\n      \"url\": \"https://github.com/github/hubot/raw/master/LICENSE\"\n    }\n  ],\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"https://github.com/github/hubot.git\"\n  },\n  \"dependencies\": {\n    \"hubot\": \">= 2.6.0 < 3.0.0\",\n    \"hubot-scripts\": \">= 2.5.0 < 3.0.0\",\n    \"hubot-irc\": \"^0.2.7\",\n    \"hubot-victory\": \">= 0.0.0\",\n    \"hubot-heroku-keepalive\": \"0.0.4\",\n    \"hubot-aws-sns\": \"0.3.5\"\n  },\n  \"engines\": {\n    \"node\": \">= 0.8.x\",\n    \"npm\": \">= 1.1.x\"\n  },\n  \"scripts\": {\n    \"test\": \"grep 'redis-brain.coffee' hubot-scripts.json\"\n  }\n}\n","markers":{"markers":{"1":{"id":1,"range":[[28,27],[28,27]],"tailed":false,"reversed":true,"valid":true,"invalidate":"never","persistent":true,"properties":{"type":"selection","editorId":74,"goalScreenRange":null,"preserveFolds":true},"deserializer":"Marker"}},"deserializer":"MarkerManager"},"history":{"undoStack":[],"redoStack":[{"patches":[{"oldRange":[[28,27],[28,28]],"newRange":[[28,27],[28,27]],"oldText":"]","newText":"","normalizeLineEndings":true,"oldMarkersSnapshot":{"55":{"range":[[28,0],[28,29]],"valid":true},"56":{"range":[[28,0],[28,29]],"valid":true}},"deserializer":"BufferPatch"}],"oldMarkersSnapshot":{"1":{"range":[[28,28],[28,28]],"valid":true},"55":{"range":[[28,0],[28,29]],"valid":true},"56":{"range":[[28,0],[28,29]],"valid":true}},"newMarkersSnapshot":{"1":{"range":[[28,27],[28,27]],"valid":true}},"deserializer":"Transaction"}],"deserializer":"History","version":1},"encoding":"utf8","filePath":"/Users/lonnen/repos/leeroybot/package.json","modifiedWhenLastPersisted":false,"digestWhenLastPersisted":"d51e677d77513d790ca07030821262a2d0b130ef","deserializer":"TextBuffer"}],"deserializer":"Project"},"workspace":{"paneContainer":{"root":{"id":3,"items":[{"id":46,"softTabs":true,"displayBuffer":{"id":47,"softWrapped":true,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/lonnen/repos/leeroybot/scripts/travis.coffee","invisibles":null,"deserializer":"TokenizedBuffer"},"invisibles":null,"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"},{"id":74,"softTabs":true,"displayBuffer":{"id":75,"softWrapped":true,"editorWidthInChars":null,"scrollTop":0,"scrollLeft":0,"tokenizedBuffer":{"bufferPath":"/Users/lonnen/repos/leeroybot/package.json","invisibles":null,"deserializer":"TokenizedBuffer"},"invisibles":null,"deserializer":"DisplayBuffer"},"deserializer":"TextEditor"}],"activeItemURI":"/Users/lonnen/repos/leeroybot/scripts/travis.coffee","focused":true,"flexScale":1,"deserializer":"Pane"},"activePaneId":3,"deserializer":"PaneContainer","version":1},"fullScreen":false,"packagesWithActiveGrammars":["language-coffee-script","language-javascript","language-json","language-hyperlink","language-todo"],"deserializer":"Workspace"},"grammars":{"deserializer":"GrammarRegistry","grammarOverridesByPath":{}},"packageStates":{"command-logger":{"eventLog":{"core:move-up":{"count":440,"name":"core:move-up","lastRun":1430183142685},"editor:newline":{"count":210,"name":"editor:newline","lastRun":1430172741473},"core:paste":{"count":122,"name":"core:paste","lastRun":1430183752636},"core:cut":{"count":16,"name":"core:cut","lastRun":1427692174673},"core:backspace":{"count":2195,"name":"core:backspace","lastRun":1430197912319},"core:save":{"count":239,"name":"core:save","lastRun":1430197913579},"fuzzy-finder:toggle-file-finder":{"count":7,"name":"fuzzy-finder:toggle-file-finder","lastRun":1429552477882},"core:cancel":{"count":14,"name":"core:cancel","lastRun":1429552478817},"application:new-file":{"count":4,"name":"application:new-file","lastRun":1420859414305},"core:close":{"count":168,"name":"core:close","lastRun":1430238171382},"core:move-down":{"count":852,"name":"core:move-down","lastRun":1430197243657},"core:select-down":{"count":119,"name":"core:select-down","lastRun":1429552356036},"core:move-right":{"count":559,"name":"core:move-right","lastRun":1430184264730},"core:move-left":{"count":486,"name":"core:move-left","lastRun":1430197245467},"core:delete":{"count":272,"name":"core:delete","lastRun":1429552375046},"editor:move-to-first-character-of-line":{"count":47,"name":"editor:move-to-first-character-of-line","lastRun":1429552462576},"editor:move-to-end-of-screen-line":{"count":75,"name":"editor:move-to-end-of-screen-line","lastRun":1430183738118},"core:undo":{"count":167,"name":"core:undo","lastRun":1430238176885},"core:move-to-top":{"count":7,"name":"core:move-to-top","lastRun":1429552304252},"core:move-to-bottom":{"count":2,"name":"core:move-to-bottom","lastRun":1413233233115},"core:redo":{"count":32,"name":"core:redo","lastRun":1427756709641},"find-and-replace:show":{"count":33,"name":"find-and-replace:show","lastRun":1430182526335},"core:confirm":{"count":74,"name":"core:confirm","lastRun":1430182528062},"pane:show-previous-item":{"count":74,"name":"pane:show-previous-item","lastRun":1430238208081},"core:copy":{"count":69,"name":"core:copy","lastRun":1430183750733},"pane:show-next-item":{"count":72,"name":"pane:show-next-item","lastRun":1430238183966},"project-find:show":{"count":9,"name":"project-find:show","lastRun":1427683050539},"spell-check:correct-misspelling":{"count":1,"name":"spell-check:correct-misspelling","lastRun":1412573292073},"core:select-up":{"count":14,"name":"core:select-up","lastRun":1429552355021},"core:select-all":{"count":21,"name":"core:select-all","lastRun":1429664884012},"tree-view:remove":{"count":8,"name":"tree-view:remove","lastRun":1429926921536},"tree-view:add-file":{"count":3,"name":"tree-view:add-file","lastRun":1428632945333},"editor:indent":{"count":29,"name":"editor:indent","lastRun":1429552475384},"editor:indent-selected-rows":{"count":3,"name":"editor:indent-selected-rows","lastRun":1412728800369},"editor:select-to-end-of-line":{"count":4,"name":"editor:select-to-end-of-line","lastRun":1428084103226},"editor:select-to-first-character-of-line":{"count":5,"name":"editor:select-to-first-character-of-line","lastRun":1429552356702},"settings-view:open":{"count":1,"name":"settings-view:open","lastRun":1412881451426},"settings-view:install-packages":{"count":2,"name":"settings-view:install-packages","lastRun":1420859339577},"window:update-available":{"count":8,"name":"window:update-available","lastRun":1430181768031},"pane:item-added":{"count":68,"name":"pane:item-added","lastRun":1430183703283},"pane-container:active-pane-item-changed":{"count":201,"name":"pane-container:active-pane-item-changed","lastRun":1430238208065},"pane:active-item-changed":{"count":181,"name":"pane:active-item-changed","lastRun":1430238208080},"editor:display-updated":{"count":8130,"name":"editor:display-updated","lastRun":1430330701284},"editor:attached":{"count":68,"name":"editor:attached","lastRun":1430183703299},"pane:before-item-destroyed":{"count":66,"name":"pane:before-item-destroyed","lastRun":1430238171354},"editor:detached":{"count":167,"name":"editor:detached","lastRun":1430238171381},"editor:will-be-removed":{"count":167,"name":"editor:will-be-removed","lastRun":1430238171381},"pane:item-removed":{"count":66,"name":"pane:item-removed","lastRun":1430238171376},"cursor:moved":{"count":2748,"name":"cursor:moved","lastRun":1430238176888},"selection:changed":{"count":2777,"name":"selection:changed","lastRun":1430264927585},"pane:active-item-modified-status-changed":{"count":141,"name":"pane:active-item-modified-status-changed","lastRun":1430264926279},"editor:delete-to-beginning-of-line":{"count":2,"name":"editor:delete-to-beginning-of-line","lastRun":1427683048921},"editor:consolidate-selections":{"count":4,"name":"editor:consolidate-selections","lastRun":1429552478806},"snippets:next-tab-stop":{"count":4,"name":"snippets:next-tab-stop","lastRun":1429552475375},"snippets:expand":{"count":4,"name":"snippets:expand","lastRun":1429552475377},"core:select-left":{"count":156,"name":"core:select-left","lastRun":1428083989438},"core:select-right":{"count":54,"name":"core:select-right","lastRun":1429552357764},"editor:outdent-selected-rows":{"count":12,"name":"editor:outdent-selected-rows","lastRun":1427690193808},"application:quit":{"count":4,"name":"application:quit","lastRun":1429029517798},"tree-view:move":{"count":1,"name":"tree-view:move","lastRun":1428084214571},"pane:active-item-title-changed":{"count":2,"name":"pane:active-item-title-changed","lastRun":1428632877300},"core:select-to-bottom":{"count":2,"name":"core:select-to-bottom","lastRun":1429552301984}}},"find-and-replace":{"viewState":"","modelState":{"useRegex":true,"inCurrentSelection":false,"caseSensitive":true,"wholeWord":false},"projectViewState":"","resultsModelState":{"useRegex":false,"caseSensitive":false},"findHistory":["scrip","redis","redis-brain","leeroybot","\\n","travis me","author_name","dire","die","payload","o.","payloa","redis","info.","info ","env","config","params"],"replaceHistory":["LeeroyBot"," "],"pathsHistory":["LeeroyBot"," "]},"fuzzy-finder":{"/Users/lonnen/repos/leeroybot/scripts/travis.coffee":1430264925052,"/Users/lonnen/repos/leeroybot/package.json":1430238183966},"keybinding-resolver":{},"metrics":{"sessionLength":65776403},"tree-view":{"directoryExpansionStates":{"/Users/lonnen/repos/leeroybot":{"isExpanded":true,"entries":{".git":{"isExpanded":false,"entries":{}},"bin":{"isExpanded":false,"entries":{}},"node_modules":{"isExpanded":true,"entries":{".bin":{"isExpanded":false,"entries":{}},"hubot":{"isExpanded":false,"entries":{}},"hubot-aws-sns":{"isExpanded":false,"entries":{}},"hubot-heroku-keepalive":{"isExpanded":true,"entries":{"script":{"isExpanded":false,"entries":{}},"src":{"isExpanded":true,"entries":{}},"test":{"isExpanded":false,"entries":{}}}},"hubot-irc":{"isExpanded":false,"entries":{}},"hubot-scripts":{"isExpanded":false,"entries":{}},"hubot-victory":{"isExpanded":false,"entries":{}},"urls":{"isExpanded":false,"entries":{}}}},"scripts":{"isExpanded":true,"entries":{}}}}},"selectedPath":"/Users/lonnen/repos/leeroybot/scripts/travis.coffee","hasFocus":false,"attached":true,"scrollLeft":0,"scrollTop":0,"width":200}}}